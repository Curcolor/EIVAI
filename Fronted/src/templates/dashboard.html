{% extends "base.html" %}

{% block title %}Inicio{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 text-primary">
                <i class="fas fa-home me-2"></i>
                Bienvenido a EIVAI
            </h1>
            <div class="badge bg-success fs-6 system-active">
                <i class="fas fa-heartbeat me-1"></i>
                Sistema Activo
            </div>
        </div>
    </div>
</div>

<!-- Estadísticas principales -->
<div class="row mb-4">
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100 stats-card">
            <div class="card-body text-center">
                <div class="stats-icon">
                    <i class="fas fa-tools fa-lg"></i>
                </div>
                <h5 class="card-title text-muted mb-2">Herramientas Registradas</h5>
                <h3 class="text-primary fw-bold" id="total-tools">248</h3>
                <small class="text-muted">Base de datos actualizada</small>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100 stats-card">
            <div class="card-body text-center">
                <div class="stats-icon">
                    <i class="fas fa-check-circle fa-lg"></i>
                </div>
                <h5 class="card-title text-muted mb-2">Identificaciones Exitosas</h5>
                <h3 class="text-success fw-bold" id="successful-id">1,247</h3>
                <small class="text-muted">Últimos 30 días</small>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100 stats-card">
            <div class="card-body text-center">
                <div class="stats-icon">
                    <i class="fas fa-clock fa-lg"></i>
                </div>
                <h5 class="card-title text-muted mb-2">Tiempo Promedio</h5>
                <h3 class="text-warning fw-bold" id="avg-time">2.3s</h3>
                <small class="text-muted">Procesamiento IA</small>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100 stats-card">
            <div class="card-body text-center">                <div class="stats-icon">
                    <i class="fas fa-percentage fa-lg"></i>
                </div>
                <h5 class="card-title text-muted mb-2">Precisión</h5>
                <h3 class="text-info fw-bold" id="accuracy">96.7%</h3>
                <small class="text-muted">Modelo v2.1.0</small>
            </div>
        </div>
    </div>
</div>

<!-- Sección de bienvenida -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm bg-gradient text-white" style="background: linear-gradient(135deg, var(--azul-profundo), var(--verde-quirurgico));">
            <div class="card-body text-center py-5">
                <i class="fas fa-user-md fa-3x mb-3"></i>
                <h2 class="mb-3">Sistema de Identificación de Herramientas Quirúrgicas</h2>
                <p class="lead mb-4">
                    Utiliza inteligencia artificial avanzada para identificar y clasificar herramientas quirúrgicas 
                    con precisión y eficiencia en tiempo real.
                </p>
                <div class="row text-center">
                    <div class="col-md-4">
                        <i class="fas fa-brain fa-2x mb-2"></i>
                        <h5>IA Avanzada</h5>
                        <p>Modelos entrenados con miles de imágenes quirúrgicas</p>
                    </div>
                    <div class="col-md-4">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <h5>Tiempo Real</h5>
                        <p>Identificación en menos de 3 segundos</p>
                    </div>
                    <div class="col-md-4">
                        <i class="fas fa-shield-alt fa-2x mb-2"></i>
                        <h5>Confiable</h5>
                        <p>Precisión superior al 95%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Panel de información del sistema -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line me-2"></i>
                    Resumen de Actividad
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-muted mb-3">Estadísticas del Día</h6>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Identificaciones completadas:</span>
                            <strong>42</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tiempo promedio:</span>
                            <strong>2.1s</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Precisión promedio:</span>
                            <strong>95.3%</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Usuarios activos:</span>
                            <strong>7</strong>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted mb-3">Estado del Sistema</h6>
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-success rounded-circle me-2" style="width: 10px; height: 10px;"></div>
                            <span>Servidor principal activo</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-success rounded-circle me-2" style="width: 10px; height: 10px;"></div>
                            <span>Base de datos conectada</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-success rounded-circle me-2" style="width: 10px; height: 10px;"></div>
                            <span>Modelos IA cargados</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="bg-warning rounded-circle me-2" style="width: 10px; height: 10px;"></div>
                            <span>Cache en optimización</span>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <a href="/identificacion" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-camera me-2"></i>
                            Ir a Identificación de Herramientas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Panel de información lateral -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm mb-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Información del Sistema
                </h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <strong>Versión:</strong> <span class="text-muted">v2.1.0</span>
                </div>
                <div class="mb-3">
                    <strong>Última actualización:</strong> <span class="text-muted">26/05/2025</span>
                </div>
                <div class="mb-3">
                    <strong>Estado del servidor:</strong> 
                    <span class="badge bg-success">Conectado</span>
                </div>
                <div class="mb-3">
                    <strong>Modelos disponibles:</strong> 
                    <span class="text-muted">15</span>
                </div>
            </div>
        </div>
        
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h6 class="mb-0">
                    <i class="fas fa-clock me-2"></i>
                    Accesos Rápidos
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="/identificacion" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-camera me-2"></i>
                        Identificar Herramientas
                    </a>
                    <a href="#" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-chart-bar me-2"></i>
                        Ver Reportes
                    </a>
                    <a href="#" class="btn btn-outline-info btn-sm">
                        <i class="fas fa-cog me-2"></i>
                        Configuración
                    </a>                </div>
            </div>
        </div>
    </div>
</div>

<style>
:root {
    --azul-profundo: #1B365D;
    --verde-quirurgico: #2F7E79;
    --gris-acero: #BFCAD3;
    --cian: #1BCDB0;
}

body {
    background-color: #f8fafc;
}

.text-primary {
    color: var(--azul-profundo) !important;
}

.bg-primary {
    background-color: var(--azul-profundo) !important;
}

.btn-primary {
    background-color: var(--azul-profundo);
    border-color: var(--azul-profundo);
}

.btn-primary:hover {
    background-color: #0f2a4a;
    border-color: #0f2a4a;
}

.btn-outline-primary {
    color: var(--azul-profundo);
    border-color: var(--azul-profundo);
}

.btn-outline-primary:hover {
    background-color: var(--azul-profundo);
    border-color: var(--azul-profundo);
}

.text-success {
    color: var(--verde-quirurgico) !important;
}

.bg-success {
    background-color: var(--verde-quirurgico) !important;
}

.badge.bg-success {
    background-color: var(--verde-quirurgico) !important;
}

.text-info {
    color: var(--cian) !important;
}

.bg-info {
    background-color: var(--cian) !important;
}

.bg-secondary {
    background-color: var(--gris-acero) !important;
    color: var(--azul-profundo) !important;
}

.navbar-dark .navbar-brand {
    color: white !important;
}

.upload-area {
    cursor: pointer;
    transition: all 0.3s ease;
    border-color: var(--azul-profundo) !important;
}

.upload-area:hover {
    background-color: rgba(27, 54, 93, 0.05);
    border-color: var(--azul-profundo) !important;
    box-shadow: 0 0 15px rgba(27, 54, 93, 0.1);
}

.upload-area.dragover {
    background-color: rgba(27, 205, 176, 0.1);
    border-color: var(--cian) !important;
    box-shadow: 0 0 20px rgba(27, 205, 176, 0.2);
}

.card {
    transition: all 0.3s ease;
    border: 1px solid rgba(191, 202, 211, 0.3);
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(27, 54, 93, 0.15);
}

.card-header {
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.table th {
    font-weight: 600;
    color: var(--azul-profundo);
    background-color: rgba(191, 202, 211, 0.2) !important;
}

.table-hover tbody tr:hover {
    background-color: rgba(27, 205, 176, 0.05);
}

.badge {
    font-size: 0.75em;
    padding: 0.5em 0.75em;
}

.badge.bg-warning {
    background-color: #f39c12 !important;
    color: white;
}

#identification-results {
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(27, 54, 93, 0.02) 0%, rgba(191, 202, 211, 0.05) 100%);
    border-radius: 8px;
}

.result-item {
    border-left: 4px solid var(--verde-quirurgico);
    padding-left: 15px;
    margin-bottom: 15px;
    background: rgba(47, 126, 121, 0.02);
    border-radius: 0 8px 8px 0;
    padding: 15px;
}

.result-item.border-success {
    border-left-color: var(--cian);
    background: rgba(27, 205, 176, 0.05);
}

.confidence-bar {
    height: 10px;
    background-color: rgba(191, 202, 211, 0.3);
    border-radius: 5px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--verde-quirurgico) 0%, var(--cian) 50%, #f39c12 80%, #e74c3c 100%);
    transition: width 0.8s ease;
    border-radius: 5px;
}

.stats-card {
    background: linear-gradient(135deg, white 0%, rgba(191, 202, 211, 0.1) 100%);
    border: 1px solid rgba(191, 202, 211, 0.2);
}

.stats-icon {
    background: linear-gradient(135deg, var(--azul-profundo) 0%, var(--verde-quirurgico) 100%);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
}

.btn-outline-light:hover {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.modal-header {
    background: linear-gradient(135deg, var(--azul-profundo) 0%, var(--verde-quirurgico) 100%);
    color: white;
}

.modal-header .btn-close {
    filter: invert(1);
}

/* Animaciones */
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(27, 205, 176, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(27, 205, 176, 0); }
    100% { box-shadow: 0 0 0 0 rgba(27, 205, 176, 0); }
}

.system-active {
    animation: pulse 2s infinite;
}

/* Efectos adicionales */
.card-body {
    position: relative;
    overflow: hidden;
}

.card-body::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(27, 205, 176, 0.03), transparent);
    transform: rotate(45deg);
    transition: all 0.5s ease;
    opacity: 0;
}

.card:hover .card-body::before {
    opacity: 1;
    top: -60%;
    left: -60%;
}
</style>

<script>
// Variables globales
let currentImage = null;

// Inicialización cuando se carga la página
document.addEventListener('DOMContentLoaded', function() {
    initializeUploadArea();
    initializeImageInput();
    updateStats();
});

// Configurar área de upload con drag & drop
function initializeUploadArea() {
    const uploadArea = document.getElementById('upload-area');
    
    uploadArea.addEventListener('click', () => {
        document.getElementById('tool-image').click();
    });
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type.startsWith('image/')) {
            handleImageUpload(files[0]);
        }
    });
}

// Configurar input de imagen
function initializeImageInput() {
    document.getElementById('tool-image').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            handleImageUpload(e.target.files[0]);
        }
    });
}

// Manejar carga de imagen
function handleImageUpload(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const previewContainer = document.getElementById('preview-container');
        const imagePreview = document.getElementById('image-preview');
        const uploadArea = document.getElementById('upload-area');
        const identifyBtn = document.getElementById('identify-btn');
        
        imagePreview.src = e.target.result;
        uploadArea.classList.add('d-none');
        previewContainer.classList.remove('d-none');
        identifyBtn.disabled = false;
        
        currentImage = file;
        
        // Limpiar resultados anteriores
        document.getElementById('identification-results').innerHTML = `
            <div class="text-center text-muted">
                <i class="fas fa-image fa-2x mb-3"></i>
                <p>Imagen cargada correctamente. Haz clic en "Identificar Herramienta" para continuar.</p>
            </div>
        `;
    };
    reader.readAsDataURL(file);
}

// Limpiar imagen
function clearImage() {
    const previewContainer = document.getElementById('preview-container');
    const uploadArea = document.getElementById('upload-area');
    const identifyBtn = document.getElementById('identify-btn');
    
    previewContainer.classList.add('d-none');
    uploadArea.classList.remove('d-none');
    identifyBtn.disabled = true;
    currentImage = null;
    
    document.getElementById('identification-results').innerHTML = `
        <div class="text-center text-muted">
            <i class="fas fa-search fa-2x mb-3"></i>
            <p>Carga una imagen para comenzar la identificación</p>
        </div>
    `;
}

// Identificar herramienta (simulado)
document.getElementById('identify-btn').addEventListener('click', function() {
    if (!currentImage) return;
    
    const btn = this;
    const originalText = btn.innerHTML;
    
    // Mostrar estado de carga
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Identificando...';
    btn.disabled = true;
    
    // Simular procesamiento
    setTimeout(() => {
        showIdentificationResults();
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        // Actualizar estadísticas
        updateStats();
        addToHistory();
    }, 2000);
});

// Mostrar resultados de identificación (simulado)
function showIdentificationResults() {
    const results = [
        { name: 'Bisturí #15', confidence: 96.8, category: 'Instrumental de corte' },
        { name: 'Bisturí #11', confidence: 78.2, category: 'Instrumental de corte' },
        { name: 'Escalpelo quirúrgico', confidence: 65.4, category: 'Instrumental de corte' }
    ];
    
    const resultsHtml = results.map((result, index) => `
        <div class="result-item ${index === 0 ? 'border-success' : ''}">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0 ${index === 0 ? 'text-success fw-bold' : ''}">${result.name}</h6>
                <span class="badge ${index === 0 ? 'bg-success' : 'bg-secondary'}">${result.confidence}%</span>
            </div>
            <p class="text-muted small mb-2">${result.category}</p>
            <div class="confidence-bar">
                <div class="confidence-fill" style="width: ${result.confidence}%"></div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('identification-results').innerHTML = `
        <div class="w-100">
            <h6 class="text-success mb-3">
                <i class="fas fa-check-circle me-2"></i>
                Identificación Completada
            </h6>
            ${resultsHtml}
        </div>
    `;
}

// Actualizar estadísticas (simulado)
function updateStats() {
    const stats = {
        totalTools: Math.floor(Math.random() * 50) + 200,
        successfulId: Math.floor(Math.random() * 200) + 1000,
        avgTime: (Math.random() * 2 + 1).toFixed(1) + 's',
        accuracy: (Math.random() * 5 + 95).toFixed(1) + '%'
    };
    
    document.getElementById('total-tools').textContent = stats.totalTools;
    document.getElementById('successful-id').textContent = stats.successfulId.toLocaleString();
    document.getElementById('avg-time').textContent = stats.avgTime;
    document.getElementById('accuracy').textContent = stats.accuracy;
}

// Inicializar estadísticas al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    updateStats();
    
    // Actualizar estadísticas cada 30 segundos
    setInterval(updateStats, 30000);
});
</script>

<!-- Font Awesome para iconos -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}